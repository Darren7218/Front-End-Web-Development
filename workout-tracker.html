<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workout Tracker - FitnessTech</title>

<!-- Bootstrap, Chart.js, jQuery -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- jsPDF for PDF export -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
body { font-family: 'Segoe UI', sans-serif; background:#fafafa; transition:background 0.3s, color 0.3s; }
.navbar { box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
.navbar .nav-link { color:#333; }
.navbar .nav-link:hover { color:#007bff; }
.header { text-align:center; padding:40px 20px; background:#f8f9fa; border-bottom:1px solid #ddd; }
.header h2 { font-size:2rem; font-weight:bold; }
.card-custom { background:#fff; border-radius:10px; padding:20px; box-shadow:0 2px 8px rgba(0,0,0,0.05); margin-bottom:20px; transition:background 0.3s, color 0.3s; }
.card-custom h3 { font-size:1.3rem; margin-bottom:15px; }
.table th, .table td { vertical-align:middle; }
.table thead th { background:#f1f1f1; transition:background 0.3s; }
.footer { background:#fff; padding:20px; text-align:center; border-top:1px solid #ddd; transition:background 0.3s, color 0.3s; }
.footer hr { margin:15px auto; width:90%; }
body.dark-mode { background:#121212; color:#e0e0e0; }
body.dark-mode .navbar { background:#1e1e1e !important; }
body.dark-mode .navbar .nav-link,
body.dark-mode .navbar .navbar-brand { color:#fff !important; }
body.dark-mode .navbar .nav-link:hover { color:#f0ad4e !important; }
body.dark-mode .header { background:#1e1e1e; border-bottom-color:#333; }
body.dark-mode .card-custom { background:#1f1f1f; color:#e0e0e0; }
body.dark-mode .table thead th { background:#333; color:#fff; }
body.dark-mode .footer { background:#1e1e1e; color:#ccc; }
#bmiResult { font-weight:bold; font-size:1.1rem; margin-top:10px; }
#quoteBox { font-style:italic; font-size:0.95rem; margin-top:10px; }

/* small control buttons next to charts */
.chart-controls { display:flex; gap:8px; align-items:center; margin:8px 0 14px; }
.chart-controls .btn { font-size:0.9rem; padding:6px 10px; }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light px-3">
  <a class="navbar-brand fw-bold" href="index.html">FitnessTech</a>
  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav ms-auto">
      <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
      <li class="nav-item"><a class="nav-link" href="fitness-gadgets.html">Gadgets</a></li>
      <li class="nav-item"><a class="nav-link active" href="workout-tracker.html">Workout Tracker</a></li>
      <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
      <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
      <li class="nav-item"><a class="nav-link" href="login.html" id="navLogin">Login</a></li>
      <li class="nav-item"><a class="nav-link" href="#" id="navLogout" style="display:none;" onclick="logout();return false;">Logout</a></li>
      <li class="nav-item">
        <button id="darkModeToggle" class="btn btn-outline-secondary btn-sm ms-3">üåô Dark Mode</button>
      </li>
    </ul>
  </div>
</nav>

<script>
document.addEventListener('DOMContentLoaded', () => {
  if(sessionStorage.getItem('isLoggedIn')==='true'){
    document.getElementById('navLogin').style.display='none';
    document.getElementById('navLogout').style.display='inline';
  }
  const toggleBtn = document.getElementById('darkModeToggle');
  const isDark = localStorage.getItem('darkMode') === 'true';
  if(isDark) document.body.classList.add('dark-mode');
  toggleBtn.textContent = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
  toggleBtn.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    const dark = document.body.classList.contains('dark-mode');
    localStorage.setItem('darkMode', dark);
    toggleBtn.textContent = dark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
  });
});
</script>

<!-- Header -->
<section class="header">
  <h2>Workout Tracker</h2>
  <p class="text-muted">Log your exercises, calculate BMI, track your progress & get motivated.</p>
  <div id="quoteBox" class="text-primary"></div>
</section>

<!-- Main Content -->
<div class="container mt-4">
  <div class="row">
    <!-- Left Column -->
    <div class="col-md-4">
      <!-- Add Workout Form -->
      <div class="card-custom">
        <h3>Add Workout</h3>
        <form id="wForm">
          <div class="mb-3">
            <label class="form-label">Date</label>
            <input class="form-control" id="date" type="date" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Exercise</label>
            <input class="form-control" id="ex" required placeholder="Running, Push Ups">
          </div>
          <div class="mb-3">
            <label class="form-label">Duration (min)</label>
            <input class="form-control" id="du" type="number" min="1" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Calories Burned</label>
            <input class="form-control" id="cal" type="text" readonly>
          </div>
          <div class="mb-3">
            <label class="form-label">Notes</label>
            <textarea class="form-control" id="notes" rows="2" placeholder="Add personal notes..."></textarea>
          </div>
          <button class="btn btn-primary w-100" type="submit">Save Workout</button>
        </form>

        <!-- Preset Workouts -->
        <h5 class="mt-3">Workout Presets</h5>
        <button class="btn btn-outline-secondary btn-sm" onclick="loadPreset('Beginner Run')">Beginner 30-min Run</button>
        <button class="btn btn-outline-secondary btn-sm mt-2" onclick="loadPreset('Full Body')">Full-body Strength</button>
      </div>

      <!-- BMI Calculator -->
      <div class="card-custom">
        <h3>BMI & BMR Calculator</h3>
        <div class="mb-3"><label class="form-label">Weight (kg)</label><input type="number" class="form-control" id="weight" min="1"></div>
        <div class="mb-3"><label class="form-label">Height (cm)</label><input type="number" class="form-control" id="height" min="1"></div>
        <div class="mb-3"><label class="form-label">Age</label><input type="number" class="form-control" id="age" min="1"></div>
        <div class="mb-3"><label class="form-label">Gender</label>
          <select id="gender" class="form-select"><option value="male">Male</option><option value="female">Female</option></select>
        </div>
        <button class="btn btn-success w-100" onclick="calculateBMI()">Calculate</button>
        <div id="bmiResult" class="text-center mt-3"></div>

        <!-- BMI chart controls -->
        <div class="chart-controls" style="justify-content:center;">
          <button class="btn btn-outline-primary btn-sm" onclick="shareChart('bmiChart', 'My BMI Chart')">Share BMI Chart</button>
          <button class="btn btn-outline-secondary btn-sm" onclick="downloadChartPNG('bmiChart', 'bmi-chart.png')">Download PNG</button>
          <button class="btn btn-outline-success btn-sm" onclick="exportChartPDF('bmiChart','bmi-chart.pdf')">Export PDF</button>
        </div>

        <canvas id="bmiChart" style="max-height:200px; margin-top:10px;"></canvas>
      </div>
    </div>

    <!-- Right Column -->
    <div class="col-md-8">
      <div class="card-custom">
        <h3>Your Workouts</h3>
        <div id="workoutContainer" class="mt-3"></div>

        <!-- Progress chart controls -->
        <div class="chart-controls">
          <button class="btn btn-outline-primary btn-sm" onclick="shareChart('progressChart', 'Calories Burned Per Day')">Share Chart</button>
          <button class="btn btn-outline-secondary btn-sm" onclick="downloadChartPNG('progressChart', 'progress-chart.png')">Download PNG</button>
          <button class="btn btn-outline-success btn-sm" onclick="exportChartPDF('progressChart','progress-chart.pdf')">Export PDF</button>
        </div>

        <canvas id="progressChart" style="max-height:300px;"></canvas>
        <button class="btn btn-danger mt-3" id="clearAll">Clear All</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚úÖ JavaScript Section -->
<script>
// Fetch Motivational Quote
fetch('https://type.fit/api/quotes')
.then(res => res.json())
.then(data => {
  const quote = data[Math.floor(Math.random() * data.length)];
  document.getElementById('quoteBox').textContent = `"${quote.text}" - ${quote.author || 'Unknown'}`;
})
.catch(()=>{ document.getElementById('quoteBox').textContent = ''; });

// Workout Presets
function loadPreset(type) {
  if(type === 'Beginner Run') {
    document.getElementById('ex').value = 'Running';
    document.getElementById('du').value = 30;
    calculateCalories();
  } else if(type === 'Full Body') {
    document.getElementById('ex').value = 'Push Ups';
    document.getElementById('du').value = 20;
    calculateCalories();
  }
}

// Basic MET values
const METS = { running: 9.8, cycling: 8.5, walking: 3.5, "push ups": 8, yoga: 3 };

document.getElementById('du').addEventListener('input', calculateCalories);
document.getElementById('ex').addEventListener('input', calculateCalories);

function calculateCalories() {
  const ex = document.getElementById('ex').value.toLowerCase();
  const duration = parseFloat(document.getElementById('du').value);
  const weight = parseFloat(document.getElementById('weight').value) || 70;
  if (!ex || !duration) { document.getElementById('cal').value = ''; return; }
  const met = METS[ex] || 5;
  const calories = ((met * 3.5 * weight) / 200) * duration;
  document.getElementById('cal').value = calories.toFixed(0);
}

// ‚úÖ BMI Calculation with System Date in Chart
let bmiHistoryData = JSON.parse(localStorage.getItem('bmiData') || '[]');
let bmiChart;

function calculateBMI() {
  const weight = parseFloat(document.getElementById('weight').value);
  const height = parseFloat(document.getElementById('height').value) / 100;
  const age = parseInt(document.getElementById('age').value);
  const gender = document.getElementById('gender').value;

  if (!weight || !height || !age) return alert('Fill all fields!');

  const bmi = (weight / (height * height)).toFixed(1);
  const category = bmi < 18.5 ? 'Underweight' : bmi < 25 ? 'Normal' : bmi < 30 ? 'Overweight' : 'Obese';
  const bmr = gender === 'male'
    ? (88.36 + 13.4 * weight + 4.8 * (height * 100) - 5.7 * age).toFixed(0)
    : (447.6 + 9.2 * weight + 3.1 * (height * 100) - 4.3 * age).toFixed(0);

  document.getElementById('bmiResult').innerHTML =
    `BMI: ${bmi} (${category})<br>BMR: ${bmr} kcal/day`;

  // Save to history with date
  const today = new Date().toLocaleDateString();
  bmiHistoryData.push({ date: today, bmi: parseFloat(bmi), bmr: parseFloat(bmr), weight, height: height * 100 });
  localStorage.setItem('bmiData', JSON.stringify(bmiHistoryData));

  updateBMIChart();
}

function updateBMIChart() {
  if (bmiChart) bmiChart.destroy();

  // Sort by date
  const sorted = [...bmiHistoryData].sort((a, b) => new Date(a.date) - new Date(b.date));
  const labels = sorted.map(d => d.date);
  const values = sorted.map(d => d.bmi);

  const ctx = document.getElementById('bmiChart').getContext('2d');
  bmiChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'BMI Over Time',
        data: values,
        borderColor: '#28a745',
        backgroundColor: 'rgba(40, 167, 69, 0.1)',
        fill: true,
        tension: 0.2
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: false }
      }
    }
  });
}



// Workout Logic
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('date').valueAsDate = new Date();
  updateBMIChart();
  render();
});

function getList() { return JSON.parse(localStorage.getItem('workouts')||'[]'); }
function setList(arr) { localStorage.setItem('workouts', JSON.stringify(arr)); }

function groupByDate(list) {
  return list.reduce((acc, w) => { acc[w.date] = acc[w.date] || []; acc[w.date].push(w); return acc; }, {});
}

function render() {
  const container = document.getElementById('workoutContainer');
  container.innerHTML = '';
  const grouped = groupByDate(getList());
  for (const date in grouped) {
    const section = document.createElement('div');
    section.innerHTML = `<h5 class="mt-3">${date}</h5>`;
    const table = document.createElement('table');
    table.className = 'table table-bordered table-striped';
    table.innerHTML = '<thead><tr><th>Exercise</th><th>Duration</th><th>Calories</th><th>Notes</th><th>Action</th></tr></thead>';
    const tbody = document.createElement('tbody');
    grouped[date].forEach((w, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${w.exercise}</td><td>${w.duration} min</td><td>${w.calories}</td><td>${w.notes}</td>
        <td><button class="btn btn-sm btn-outline-danger" data-date="${date}" data-i="${i}">Delete</button></td>`;
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    section.appendChild(table);
    container.appendChild(section);
  }
  updateChart();
}

document.getElementById('wForm').addEventListener('submit', (e) => {
  e.preventDefault();
  const w = { date: date.value, exercise: ex.value.trim(), duration: +du.value, calories: +cal.value || 0, notes: notes.value.trim() };
  const list = getList();
  list.push(w);
  setList(list);
  render();
  e.target.reset();
  date.valueAsDate = new Date();
});

document.getElementById('workoutContainer').addEventListener('click', (e) => {
  if (e.target.matches('button[data-i]')) {
    const d = e.target.getAttribute('data-date');
    const i = +e.target.getAttribute('data-i');
    const grouped = groupByDate(getList());
    grouped[d].splice(i, 1);
    const newList = Object.values(grouped).flat();
    setList(newList);
    render();
  }
});

document.getElementById('clearAll').addEventListener('click', () => {
  if (confirm('Clear all workouts?')) { localStorage.removeItem('workouts'); render(); }
});

// Progress Chart
let chart;
function updateChart() {
  const workouts = getList();
  const grouped = groupByDate(workouts);
  const sortedDates = Object.keys(grouped).sort((a, b) => new Date(a) - new Date(b));
  const labels = sortedDates;
  const data = labels.map(d => grouped[d].reduce((s, w) => s + (+w.calories || 0), 0));

  if (chart) chart.destroy();
  chart = new Chart(progressChart.getContext('2d'), {
    type: 'bar',
    data: { labels, datasets: [{ label: 'Calories Burned Per Day', data, backgroundColor: '#007bff' }] },
    options: { responsive: true, scales: { y: { beginAtZero: true } } }
  });
}

/* ---------------------------
   Share / Download / Export
   --------------------------- */
async function getCanvasBlob(canvas) {
  return await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
}

async function shareChart(canvasId, titleText = 'Chart') {
  try {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return alert('Chart not found.');
    const blob = await getCanvasBlob(canvas);
    const file = new File([blob], `${canvasId}.png`, { type: blob.type });

    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      await navigator.share({ title: titleText, text: `${titleText} from FitnessTech`, files: [file] });
      return;
    }

    const url = URL.createObjectURL(blob);
    window.open(url, '_blank');
  } catch (err) {
    console.error('Share failed', err);
    alert('Sharing not supported. Opening image...');
    const canvas = document.getElementById(canvasId);
    const dataUrl = canvas.toDataURL('image/png');
    window.open(dataUrl, '_blank');
  }
}

function downloadChartPNG(canvasId, filename = 'chart.png') {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return alert('Chart not found.');
  const dataUrl = canvas.toDataURL('image/png');
  const a = document.createElement('a');
  a.href = dataUrl;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
}

async function exportChartPDF(canvasId, filename = 'chart.pdf') {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return alert('Chart not found.');
  const dataUrl = canvas.toDataURL('image/png');

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ orientation: 'portrait', unit: 'px', format: 'a4' });

  // Add Title
  pdf.setFontSize(16);
  pdf.text("Fitness Chart Report", 20, 30);

  // Add Chart Image
  pdf.addImage(dataUrl, 'PNG', 20, 50, 400, 200);

  // Prepare data for text output
  pdf.setFontSize(12);
  pdf.text("Chart Data:", 20, 280);

  let labels = [];
  let values = [];

if (canvasId === 'bmiChart') {
  labels = bmiHistoryData.map(d => d.date);
  values = bmiHistoryData.map(d => d.bmi);
} else {
  labels = chart.data.labels;
  values = chart.data.datasets[0].data;
}

  // List out data
  let textY = 300;
  for (let i = 0; i < labels.length; i++) {
    pdf.text(`${labels[i]}: ${values[i]}`, 20, textY);
    textY += 18;
  }

  // Analyze trend
  let trend = "Stable";
  if (values.length > 1) {
    const first = values[0];
    const last = values[values.length - 1];
    if (last > first) trend = "Increasing";
    else if (last < first) trend = "Decreasing";
    else trend = "Stable";
  }

  // Summary line
  textY += 20;
  const avg = (values.reduce((a, b) => a + b, 0) / values.length).toFixed(1);
  pdf.setFontSize(13);
  pdf.text(`Summary: Trend is ${trend}, Average = ${avg}`, 20, textY);

  pdf.save(filename);
}

</script>


<!-- Footer -->
<div class="footer mt-5">
  <p><strong>FitnessTech</strong> ‚Äî learn, track, and share your fitness journey.</p>
  <hr>
  <h6>Quick Links</h6>
  <p>
    <a href="index.html">Home</a> |
    <a href="fitness-gadgets.html">Gadgets</a> |
    <a href="workout-tracker.html">Workout Tracker</a> |
    <a href="contact.html">Contact</a> |
    <a href="dashboard.html">Dashboard</a>
  </p>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>