<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>
<link rel="stylesheet" href="styles.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="app.js"></script>

</head>
<body>

<div class="navbar">
  <a class="brand" href="index.html">FitnessTech</a>
  <a href="index.html">Home</a>
  <a href="fitness-gadgets.html">Gadgets (API)</a>
  <a href="workout-tracker.html">Workout Tracker</a>
  <a href="contact.html">Contact</a>
  <span style="flex:1"></span>
  <a href="dashboard.html">Dashboard</a>
  <a href="login.html" id="navLogin">Login</a>
  <a href="#" id="navLogout" style="display:none" onclick="logout();return false;">Logout</a>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const loggedIn = sessionStorage.getItem('isLoggedIn') === 'true';
    const navLogin = document.getElementById('navLogin');
    const navLogout = document.getElementById('navLogout');
    if(loggedIn){ if(navLogin) navLogin.style.display='none'; if(navLogout) navLogout.style.display='inline'; }
  });
</script>

<div class="container">

<h2>Dashboard</h2>
<div class="grid">
  <div class="card">
    <div class="p">
      <h3>Hello, <span id="dashName"></span> ðŸ‘‹</h3>
      <p>Your quick stats and latest tips appear here. This page is protected and requires login.</p>
      <button class="btn" onclick="logout()">Logout</button>
    </div>
  </div>
  <div class="card">
    <div class="p">
      <h4>Latest Exercise Ideas (from API)</h4>
      <ul id="tipList"></ul>
      <small class="muted">Source: wger API</small>
    </div>
  </div>
  <div class="card">
    <div class="p">
      <h4>Recent Workouts (localStorage)</h4>
      <table class="table" id="recentTable">
        <thead><tr><th>Exercise</th><th>Duration</th><th>Calories</th></tr></thead>
        <tbody></tbody>
      </table>
      <a class="btn" href="workout-tracker.html">Add More</a>
    </div>
  </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const name = sessionStorage.getItem('username') || getCookie('rememberUser') || 'friend';
  document.getElementById('dashName').textContent = name;
  const workouts = JSON.parse(localStorage.getItem('workouts')||'[]').slice(-5).reverse();
  const tbody = document.querySelector('#recentTable tbody');
  workouts.forEach(w=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${w.exercise}</td><td>${w.duration} min</td><td>${w.calories}</td>`;
    tbody.appendChild(tr);
  });
  $.get('https://wger.de/api/v2/exerciseinfo/?limit=5', function(data){
    const ul = document.getElementById('tipList');
    (data.results||[]).forEach(item=>{
      const name = item.name || 'Exercise';
      const cat = (item.category && item.category.name) ? item.category.name : 'General';
      const li = document.createElement('li');
      li.textContent = `${name} â€” ${cat}`;
      ul.appendChild(li);
    });
  }).fail(function(){
    document.getElementById('tipList').innerHTML = '<li>Failed to load tips. Try again later.</li>';
  });
});
</script>

</div>

<div class="footer">
  <div class="container">
    <p><strong>FitnessTech</strong> â€” learn, track, and share your fitness journey.</p>
    <div id="sharebar" class="sharebar"></div>
    <script>document.addEventListener('DOMContentLoaded',()=>{renderShareBar('sharebar',{text:'Check out this Fitness Tech page!'});});</script>
    <hr>
    <div class="grid">
      <div>
        <p><strong>Quick Links</strong></p>
        <p><a href="index.html">Home</a><br><a href="fitness-gadgets.html">Gadgets</a><br><a href="workout-tracker.html">Workout Tracker</a></p>
      </div>
      <div>
        <p><strong>Facebook Page Plugin (example)</strong></p>
        <div class="notice">Below is a demo Facebook Page plugin iframe to satisfy the "social media plugin" requirement.</div>
        <div style="max-width:340px">
          <iframe title="Facebook Page Plugin" style="border:none;overflow:hidden;width:100%;height:140px"
            src="https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2FFacebookDevelopers&tabs=timeline&width=340&height=140&small_header=true&adapt_container_width=true&hide_cover=false&show_facepile=false">
          </iframe>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="cookiebar" class="cookiebar">
  <div class="container">
    <strong>We use cookies</strong> to remember your preferences (like your username).
    <button class="btn" onclick="acceptCookies()">Accept</button>
  </div>
</div>

<script>guard();</script>
</body>
</html>